<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Local Community Resources — Homepage</title>
<style>
  :root{
    --gap:16px;
    --max-width:1100px;
    --bg:#fff;
    --fg:#111;
    --muted:#666;
    --accent:#0b6efd;
    --card-bg:#fff;
    --radius:12px;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{background:var(--bg);color:var(--fg);line-height:1.4;display:flex;justify-content:center;padding:20px;}
  .app{width:100%;max-width:var(--max-width);}

  header.site-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:var(--gap);}
  .brand{display:flex;align-items:center;gap:12px}
  .brand h1{font-size:1.15rem;margin:0}
  nav.main-nav{display:flex;gap:12px;align-items:center}

  .sr-only{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}

  .home-grid{display:grid;gap:var(--gap);
    grid-template-columns:280px 1fr;
    grid-template-rows:auto 240px 1fr auto;
    grid-template-areas:
      "header header"
      "sidebar hero"
      "sidebar resources"
      "sidebar aside"
      "footer footer";
  }

  .home-grid > * {background:var(--card-bg);padding:16px;border-radius:8px;box-shadow:0 1px 6px rgba(0,0,0,0.04);}

  .header-area{grid-area:header;display:flex;align-items:center;justify-content:space-between}
  .sidebar{grid-area:sidebar}
  .hero{grid-area:hero;border-radius:12px;display:flex;flex-direction:column;justify-content:center;gap:10px}
  .resources{grid-area:resources;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
  .aside{grid-area:aside}
  footer.site-footer{grid-area:footer;text-align:center;font-size:0.9rem;color:var(--muted)}

  .resource-card{display:block;text-decoration:none;color:inherit;border-radius:8px;padding:12px;background:linear-gradient(180deg,#fff,#fbfbff);border:1px solid rgba(0,0,0,0.04)}
  .resource-card:focus{outline:3px solid rgba(11,110,253,0.18);outline-offset:2px}
  .resource-card h3{margin:0 0 6px 0;font-size:1rem}
  .tags{font-size:0.85rem;color:var(--muted)}
  .empty-state{padding:20px;text-align:center;color:var(--muted)}

  .controls{display:flex;gap:8px;align-items:center}
  .controls button{padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:#fff;cursor:pointer}
  .controls button:focus{outline:2px dashed var(--accent)}

  body.compact .resources{grid-auto-rows:1fr}
  body.compact .resource-card{padding:10px;font-size:0.95rem}

  @media (max-width:880px){
    .home-grid{
      grid-template-columns:1fr;
      grid-template-areas:
        "header"
        "hero"
        "controls"
        "resources"
        "aside"
        "sidebar"
        "footer";
    }
    .sidebar{order:6}
  }

  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:60}
  .modal{background:#fff;padding:20px;border-radius:12px;max-width:720px;width:95%;max-height:90vh;overflow:auto}
  .modal h2{margin-top:0}
</style>
</head>
<body>
<div class="app">
  <header class="site-header" role="banner">
    <div class="brand">
      <img src="" alt="" aria-hidden="true" style="width:40px;height:40px;border-radius:8px;background:linear-gradient(90deg,#0b6efd,#18b46a)"/>
      <h1>Community Connect</h1>
      <div class="sr-only">Local help & resources</div>
    </div>

    <nav class="main-nav" role="navigation" aria-label="Primary">
      <form id="searchForm" action="/search" method="get" role="search">
        <label for="searchInput" class="sr-only">Search resources</label>
        <input id="searchInput" name="q" type="search" placeholder="Search resources (press / to focus)" aria-label="Search resources"/>
        <button type="submit">Search</button>
      </form>

      <div class="controls" role="toolbar" aria-label="View and display controls">
        <button id="prefToggle" aria-pressed="false" title="Toggle compact view">Toggle compact</button>
      </div>
    </nav>
  </header>

  <div id="ariaStatus" role="status" aria-live="polite" class="sr-only"></div>

  <section class="home-grid" aria-label="Homepage grid">

    <div class="header-area" style="grid-area:header" aria-hidden="true">
      <div>
        <strong>Featured this week</strong>
      </div>
      <div style="font-size:.9rem;color:var(--muted)">Updated: Sep 2025</div>
    </div>

    <aside class="sidebar" aria-label="Filters and navigation">
      <h2>Filters</h2>

      <details open>
        <summary>Categories</summary>
        <form id="filterForm">
          <label><input type="checkbox" name="cat" value="food" checked/> Food & Meals</label><br/>
          <label><input type="checkbox" name="cat" value="health" checked/> Health</label><br/>
          <label><input type="checkbox" name="cat" value="legal" checked/> Legal Aid</label><br/>
          <label><input type="checkbox" name="cat" value="jobs" checked/> Jobs & Training</label><br/>
        </form>
      </details>

      <details>
        <summary>Quick links</summary>
        <nav aria-label="quick links">
          <ul>
            <li><a href="#resources">All resources</a></li>
            <li><a href="resource.html">Example resource page</a></li>
          </ul>
        </nav>
      </details>
    </aside>

    <section class="hero" aria-labelledby="heroTitle">
      <h2 id="heroTitle">Welcome — find local help fast</h2>
      <p>Priority: food, health, legal. Use filters to narrow results.</p>
      <p><em>Tip:</em> press <kbd>/</kbd> to focus search; use keyboard to open a resource (Enter/Space).</p>
    </section>

    <main id="resources" class="resources" aria-live="polite" aria-label="Resource list">
      <a href="resource.html?id=1" class="resource-card" data-id="1" data-title="Community Food Pantry" data-tags="food meals">
        <h3>Community Food Pantry</h3>
        <p>Daily meal support and grocery packages.</p>
        <div class="tags">Food · Meals</div>
      </a>

      <a href="resource.html?id=2" class="resource-card" data-id="2" data-title="Free Health Clinic" data-tags="health clinic">
        <h3>Free Health Clinic</h3>
        <p>Walk-in clinic offering vaccinations and checkups.</p>
        <div class="tags">Health · Clinic</div>
      </a>

      <a href="resource.html?id=3" class="resource-card" data-id="3" data-title="Employment Workshop" data-tags="jobs training">
        <h3>Employment Workshop</h3>
        <p>Resume help and interview coaching.</p>
        <div class="tags">Jobs · Training</div>
      </a>

      <a href="resource.html?id=4" class="resource-card" data-id="4" data-title="Legal Aid Hotline" data-tags="legal advice">
        <h3>Legal Aid Hotline</h3>
        <p>Free legal advice for housing and benefits.</p>
        <div class="tags">Legal · Advice</div>
      </a>

      <a href="resource.html?id=5" class="resource-card" data-id="5" data-title="Senior Meals Program" data-tags="food senior">
        <h3>Senior Meals Program</h3>
        <p>Delivered meals for older adults.</p>
        <div class="tags">Food · Senior</div>
      </a>

      <a href="resource.html?id=6" class="resource-card" data-id="6" data-title="Mental Health Support" data-tags="health mental">
        <h3>Mental Health Support</h3>
        <p>Peer-support group and counseling referrals.</p>
        <div class="tags">Health · Mental</div>
      </a>

    </main>

    <aside class="aside" aria-label="Community notices">
      <h2>Notices</h2>
      <p>Wednesday: free legal clinic at City Hall, 3–6pm.</p>
      <a href="#resources">See all events</a>
    </aside>

    <footer class="site-footer">
      <small>© Community Connect — Built access-first</small>
    </footer>
  </section>
</div>
<script>

(function(){
  const searchInput = document.querySelector('#searchInput');
  const resourceList = document.querySelector('#resources');
  const filterForm = document.querySelector('#filterForm');
  const prefToggle = document.querySelector('#prefToggle');
  const ariaStatus = document.querySelector('#ariaStatus');

  const onSearchInput = debounce(handleFilterInput, 180);
  const onResourceClick = handleResourceClick;
  const onResourceKeydown = handleResourceKeydown;
  const onFilterChange = handleFilterInput;
  const onPrefClick = togglePreference;

  document.addEventListener('DOMContentLoaded', init);

  function init(){
    if(searchInput) searchInput.addEventListener('input', onSearchInput);
    if(resourceList){
      resourceList.addEventListener('click', onResourceClick);
      resourceList.addEventListener('keydown', onResourceKeydown);
    }
    if(filterForm) filterForm.addEventListener('change', onFilterChange);
    if(prefToggle) prefToggle.addEventListener('click', onPrefClick);

    document.addEventListener('keydown', function(e){
      if(e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){
        e.preventDefault();
        searchInput && searchInput.focus();
      }
    });

    try {
      const pref = localStorage.getItem('cc_view');
      if(pref === 'compact'){
        document.body.classList.add('compact');
        prefToggle.setAttribute('aria-pressed','true');
      }
    } catch(err){ console.warn('Could not read prefs', err); }

    updateAriaCount();
  }

  function removeListeners(){
    try {
      if(searchInput) searchInput.removeEventListener('input', onSearchInput);
      if(resourceList){
        resourceList.removeEventListener('click', onResourceClick);
        resourceList.removeEventListener('keydown', onResourceKeydown);
      }
      if(filterForm) filterForm.removeEventListener('change', onFilterChange);
      if(prefToggle) prefToggle.removeEventListener('click', onPrefClick);
    } catch(e){ console.error('Error removing listeners', e); }
  }
  window.addEventListener('unload', removeListeners);

  function handleFilterInput(e){
    const query = (searchInput && searchInput.value || '').trim().toLowerCase();
    const cats = [];
    if(filterForm){
      const checked = [...filterForm.querySelectorAll('input[name="cat"]:checked')];
      checked.forEach(c => cats.push(c.value));
    }
    filterResources(query, cats);
  }

  function filterResources(query, cats){
    try {
      const cards = [...resourceList.querySelectorAll('.resource-card')];
      let visible = 0;
      cards.forEach(card=>{
        const title = (card.dataset.title || '').toLowerCase();
        const tags = (card.dataset.tags || '').toLowerCase();
        const catOk = !cats || cats.length === 0 ? true : cats.some(c => tags.includes(c));
        const textOk = !query ? true : (title.includes(query) || tags.includes(query));
        const show = catOk && textOk;
        card.style.display = show ? '' : 'none';
        card.setAttribute('aria-hidden', show ? 'false' : 'true');
        if(show) visible++;
      });
 
      updateAriaCount(visible);
      if(visible === 0){
        showEmptyState();
      } else {
        removeEmptyState();
      }
    } catch(err){
      console.error('Filter error', err);
      ariaStatus.textContent = 'Filter failed — try again.';
    }
  }

  function updateAriaCount(visible){
    if(visible === undefined){
      visible = [...resourceList.querySelectorAll('.resource-card')].filter(c => c.style.display !== 'none').length;
    }
    ariaStatus.textContent = `${visible} resources visible`;
  }

  function showEmptyState(){
    if(!resourceList.querySelector('.empty-state')){
      const div = document.createElement('div');
      div.className = 'empty-state';
      div.textContent = 'No resources match your filter.';
      resourceList.parentNode.insertBefore(div, resourceList.nextSibling);
    }
  }
  function removeEmptyState(){
    const e = resourceList.parentNode.querySelector('.empty-state');
    if(e) e.remove();
  }

  function togglePreference(e){
    try {
      const isCompact = document.body.classList.toggle('compact');
      prefToggle.setAttribute('aria-pressed', String(isCompact));
      localStorage.setItem('cc_view', isCompact ? 'compact' : 'comfortable');
      ariaStatus.textContent = isCompact ? 'Compact view on' : 'Comfortable view on';
    } catch(err){
      console.warn('Could not save prefs', err);
      ariaStatus.textContent = 'Preference could not be saved in your browser.';
    }
  }


  function handleResourceClick(e){
    const card = e.target.closest('.resource-card');
    if(!card) return;

    if(e.metaKey || e.ctrlKey || e.button === 1) return;
    e.preventDefault();
    openResourceModal(card);
  }

  function handleResourceKeydown(e){
    const card = e.target.closest('.resource-card');
    if(!card) return;
    if(e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      openResourceModal(card);
    }
  }

  function openResourceModal(card){
    const backdrop = document.createElement('div');
    backdrop.className = 'modal-backdrop';
    backdrop.tabIndex = -1;

    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.setAttribute('role','dialog');
    modal.setAttribute('aria-modal','true');

    const title = card.querySelector('h3') ? card.querySelector('h3').textContent : card.dataset.title || 'Resource';
    const desc = card.querySelector('p') ? card.querySelector('p').textContent : '';
    const tags = card.dataset.tags || '';

    modal.innerHTML = `
      <button class="modal-close" aria-label="Close resource" style="float:right">✕</button>
      <h2 id="modalTitle">${escapeHtml(title)}</h2>
      <p>${escapeHtml(desc)}</p>
      <p class="tags">${escapeHtml(tags)}</p>
      <p><a href="${card.href}" target="_self">Open full page</a></p>
    `;
    backdrop.appendChild(modal);
    document.body.appendChild(backdrop);

    document.querySelector('main')?.setAttribute('aria-hidden','true');

    const closeBtn = modal.querySelector('.modal-close');
    closeBtn.focus();

    function onBackdropClick(ev){
      if(ev.target === backdrop) closeModal();
    }
    function onEscape(ev){
      if(ev.key === 'Escape') closeModal();
    }
    function onTrap(ev){
      const focusables = modal.querySelectorAll('a,button,input,textarea,select,[tabindex]:not([tabindex="-1"])');
      if(focusables.length === 0) return;
      const first = focusables[0];
      const last = focusables[focusables.length - 1];
      if(ev.key === 'Tab'){
        if(ev.shiftKey && document.activeElement === first){
          ev.preventDefault(); last.focus();
        } else if(!ev.shiftKey && document.activeElement === last){
          ev.preventDefault(); first.focus();
        }
      }
    }

    backdrop.addEventListener('click', onBackdropClick);
    document.addEventListener('keydown', onEscape);
    document.addEventListener('keydown', onTrap);

    function closeModal(){
      backdrop.removeEventListener('click', onBackdropClick);
      document.removeEventListener('keydown', onEscape);
      document.removeEventListener('keydown', onTrap);
      document.querySelector('main')?.removeAttribute('aria-hidden');
      backdrop.remove();

      card.focus();
    }

    closeBtn.addEventListener('click', closeModal);
  }

  function debounce(fn, wait){
    let t;
    return function(...args){
      clearTimeout(t);
      t = setTimeout(()=>fn.apply(this,args), wait);
    };
  }

  function escapeHtml(str = ''){
    return String(str).replace(/[&<>"']/g, function(m){
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
    });
  }
})();
</script>
</body>
</html>
